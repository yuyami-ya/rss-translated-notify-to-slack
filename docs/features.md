# システム機能詳細

## 主要機能

### RSS 監視機能

- **定期チェック**: 設定された間隔で RSS フィードを監視
- **重複検出**: 既に処理済みの記事を状態ファイルで管理
- **フィード解析**: gofeed ライブラリによる堅牢な RSS 解析
- **エラーハンドリング**: ネットワークエラーや不正なフィードへの適切な対応

### 翻訳機能

- **DeepL 翻訳**: 高品質な英日翻訳
- **フォールバック**: 翻訳失敗時は原文を使用
- **API 形式対応**: JSON と form-data 両方の API 形式をサポート
- **文字数制限対応**: 長いテキストの適切な処理

### AI 要約機能

- **OpenAI API**: GPT-3.5-turbo または GPT-4 による要約生成
- **日本語要約**: 翻訳後のテキストから 3 行程度の要約を生成
- **プロンプト最適化**: 技術記事に特化したプロンプト設計
- **トークン制限**: コスト効率を考慮したトークン使用量制御

### Slack 通知機能

- **リッチ通知**: Attachment を使用した見やすい通知形式
- **スレッド対応**: タイトル投稿後、スレッドで要約を返信
- **バッチ通知**: 複数記事をまとめて通知
- **エラー通知**: システムエラーの自動通知

## システム動作フロー

### 1. 起動時の処理

1. 設定ファイルの読み込みと検証
2. 各外部 API の接続テスト
3. Slack への起動通知送信
4. RSS 監視ループの開始

### 2. 定期チェック処理

1. RSS フィードの取得と解析
2. 新規記事の検出（状態ファイルとの比較）
3. 検出された記事の処理開始

### 3. 記事処理フロー

1. **翻訳処理**:

   - タイトルの DeepL 翻訳
   - 説明文の DeepL 翻訳
   - 翻訳失敗時は原文を使用

2. **要約生成**:

   - OpenAI API による要約生成
   - 日本語で 3 行以内の要約

3. **通知送信**:
   - スレッド形式の場合: タイトル投稿 → スレッドで要約
   - 通常形式の場合: 1 つのメッセージで全情報
   - 複数記事の場合: バッチ通知または個別通知

### 4. エラー処理

- 各段階でのエラーをログに記録
- 重要なエラーは Slack に通知
- フォールバック機能による継続運用

## 状態管理

### 記事状態の永続化

- **状態ファイル**: `last_checked_state.txt`
- **GUID 管理**: 記事の一意識別子を保存
- **効率化**: 最新 1000 件のみ保持してメモリ効率を向上

### 設定の動的読み込み

- **環境変数**: 実行時の設定変更に対応
- **検証機能**: 必須設定の存在チェック
- **デフォルト値**: 適切なデフォルト設定

## パフォーマンス特性

### 処理時間

- **RSS 取得**: 通常 1-3 秒
- **DeepL 翻訳**: 記事あたり 2-5 秒
- **OpenAI 要約**: 記事あたり 2-8 秒
- **Slack 通知**: 通知あたり 1-2 秒

### API 使用量

- **DeepL**: 1 記事あたり約 500-2000 文字
- **OpenAI**: 1 記事あたり約 200-800 トークン
- **Slack**: 記事あたり 1-2 API コール

### メモリ使用量

- **基本使用量**: 約 20-50MB
- **ピーク時**: 複数記事処理時に約 100-200MB

## 拡張性

### 新機能追加の考慮点

- **モジュラー設計**: 各サービスが独立して拡張可能
- **インターフェース**: 明確な責任分担
- **設定の拡張**: 新しい環境変数の追加が容易

### 他 RSS フィードへの対応

- **汎用設計**: ByteByteGo 以外の RSS フィードにも対応可能
- **設定変更**: `FEED_URL` の変更のみで対応
- **カスタマイズ**: フィード固有の処理追加が可能
