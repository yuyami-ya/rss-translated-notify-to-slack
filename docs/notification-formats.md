# 通知形式の設定

## 通知形式の選択

### スレッド形式（推奨）

`SLACK_USE_THREADS=true` に設定

#### 特徴

- メインチャンネルにはタイトルのみ表示
- 詳細な要約はスレッド内で返信
- チャンネルが整理されて見やすい
- 他のメンバーへの通知頻度が少ない

#### 通知例

**メインメッセージ:**

```
*ByteByteGoの新しい記事が投稿されました！*

分散システムにおけるデータ一貫性の理解

原文タイトル: Understanding Data Consistency in Distributed Systems

ByteByteGo RSS通知 - 要約は下記スレッドをご確認ください
```

**スレッド返信:**

```
**記事要約**
この記事では分散システムにおけるデータ一貫性の重要性について説明しています。
ACIDプロパティとCAP定理の関係性を実例とともに解説し、実際のシステム設計での考慮点を紹介しています。
高可用性とデータ整合性のトレードオフを理解することで、より堅牢なシステム構築が可能になります。

詳細内容: データベースの分散化により、従来の単一ノードでは考慮する必要がなかった...

記事リンク: 記事を読む
```

### 通常形式

`SLACK_USE_THREADS=false` に設定

#### 特徴

- 1 つのメッセージにすべての情報を表示
- 従来の通知形式
- スレッドが使えない環境に適している

#### 通知例

```
*ByteByteGoの新しい記事が投稿されました！*

**要約**
この記事では分散システムにおけるデータ一貫性の重要性について説明しています。
ACIDプロパティとCAP定理の関係性を実例とともに解説し、実際のシステム設計での考慮点を紹介しています。
高可用性とデータ整合性のトレードオフを理解することで、より堅牢なシステム構築が可能になります。

原文タイトル: Understanding Data Consistency in Distributed Systems

詳細: データベースの分散化により、従来の単一ノードでは考慮する必要がなかった...
```

## 複数記事の処理

### バッチ通知

複数の新記事が同時に検出された場合の通知方式

#### スレッド形式の場合

1. 各記事に対して個別のスレッド通知を送信
2. レート制限を避けるため、記事間に 2 秒の間隔を設ける

#### 通常形式の場合

1. まず全記事をまとめたバッチ通知を試行
2. 失敗した場合は個別通知にフォールバック
3. 記事間に 1 秒の間隔を設ける

### バッチ通知の例

```
ByteByteGoに 3 件の新しい記事が投稿されました！

1. 分散システムにおけるデータ一貫性の理解
   要約: この記事では分散システムにおけるデータ一貫性の重要性について...

2. マイクロサービスのAPIゲートウェイ設計
   要約: マイクロサービスアーキテクチャにおけるAPIゲートウェイの役割と...

3. Kubernetesの自動スケーリング戦略
   要約: Kubernetesクラスターでの効果的な自動スケーリング手法について...
```

## 通知のカスタマイズ

### 環境変数による設定

#### 基本設定

```bash
# チャンネル指定
SLACK_CHANNEL=#tech-news

# スレッド形式の有効/無効
SLACK_USE_THREADS=true

# 通知間隔（分）
CHECK_INTERVAL_MINUTES=30
```

#### 詳細設定

```bash
# ログレベル（通知量に影響）
LOG_LEVEL=info

# タイムゾーン（通知時刻の表示）
TIMEZONE=Asia/Tokyo
```

### 通知タイミング

#### 起動時通知

システム開始時に送信される通知

```
RSS通知システムが開始されました

ByteByteGoのRSSフィード監視を開始します。

開始日時: 2024-01-15 10:30:00 JST
フィードURL: https://blog.bytebytego.com/feed
```

#### エラー通知

システムエラー発生時の自動通知

```
RSS通知システムでエラーが発生しました

RSSフィードの取得に失敗しました: connection timeout

発生日時: 2024-01-15 10:35:00 JST
```

## 通知形式の選択指針

### スレッド形式を推奨する場合

- 技術系チャンネルで定期的に記事通知を行う
- チャンネルメンバーが多く、通知頻度を抑えたい
- 記事について議論する可能性がある
- チャンネルの整理整頓を重視する

### 通常形式を推奨する場合

- 個人用チャンネルや小規模チーム
- スレッド機能を使わない運用方針
- 情報をすぐに把握したい場合
- レガシーな Slack 環境

## エラー処理と フォールバック

### 通知失敗時の処理

1. **スレッド通知失敗**: 通常形式にフォールバック
2. **Slack API エラー**: エラーログに記録
3. **ネットワークエラー**: 再試行（最大 3 回）

### 設定エラーの対処

```bash
# 無効な値の場合はデフォルト値を使用
SLACK_USE_THREADS=invalid  # → true（デフォルト）に設定
SLACK_CHANNEL=             # → #general（デフォルト）に設定
```

## 開発・テスト時の設定

### テスト用チャンネル

```bash
# 開発環境では専用チャンネルを使用
SLACK_CHANNEL=#rss-test
```

### 通知頻度の調整

```bash
# テスト時は短い間隔で確認
CHECK_INTERVAL_MINUTES=5

# 本番環境では適切な間隔に設定
CHECK_INTERVAL_MINUTES=30
```
